<div class="govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
    <li class="govuk-breadcrumbs__list-item">
      <%= link_to '/', class: 'govuk-breadcrumbs__link' do %>Home<% end %>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      <%= link_to teams_path, class: 'govuk-breadcrumbs__link' do %>
        Teams
      <% end %>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      <%= link_to team_path(@team), class: 'govuk-breadcrumbs__link' do %>
        <%= @team.name %>
      <% end %>
    </li>
  </ol>
</div>

<h1 class="govuk-heading-xl">
  <%= @team.name %>
</h1>

<% unless @team.description.blank? %>
  <p class="govuk-body" style="white-space: pre-wrap;"><%= @team.description %></p>
<% end %>

<div>
  <%= link_to new_calendar_path(team_id: @team.id), class: 'govuk-button' do %>
    New calendar
  <% end %>
</div>

<div>
  <h2 class="govuk-heading-l">Calendars</h2>
  <ul class="govuk-list govuk-list--bullet">
    <% @team.calendars.each do |calendar| %>
      <li>
        <%= link_to calendar_path(calendar), class: 'govuk-link' do %>
          <%= calendar.name %>
        <% end %>
      </li>
    <% end %>
  </ul>
</div>

<div>
  <h2 class="govuk-heading-l">Team members</h2>

  <ul class="govuk-list govuk-list--bullet">
    <% @team_members.each do |email| %>
      <li>
        <%= link_to "mailto:#{email}", class: 'govuk-link' do %>
          <%= gds_email_fmt(email) %>
        <% end %>
      </li>
    <% end %>
  </ul>
</div>

<div>
  <h2 class="govuk-heading-l">Schedule</h2>
  <div>
    <%= link_to url_for(all: true), class: 'govuk-button' do %>
      View historical events
    <% end %>
  </div>
  <table class="govuk-table">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th class="govuk-table__header">Date</th>
        <% @team.calendars.each do |team| %>
          <th class="govuk-table__header"><%= team.name %></th>
        <% end %>
      </tr>
    </thead>
    <tbody class="govuk-table__body">
      <% @events_by_calendar.each do |date, calendars_and_events| %>
        <tr class="govuk-table__row">
          <th class="govuk-table__header">
            <%= date.strftime '%Y %b %d' %>
          </th>
          <% @team.calendars.each do |team| %>
            <td class="govuk-table__cell">
              <% calendars_and_events.fetch(team, []).map { |e| e.email }.each_with_index do |email, index| %>
                <% unless index.zero? %><br><% end %>
                <%= link_to "mailto:#{email}", class: 'govuk-link' do %>
                  <%= gds_email_fmt(email) %>
                <% end %>
              <% end %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
